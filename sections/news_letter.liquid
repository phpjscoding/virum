<section
  aria-labelledby="newsletter-heading-{{ section.id }}"
  aria-describedby="newsletter-description-{{ section.id }}"
  class="py-24 text-white"
  style="background-color: {{ section.settings.background_color }};"
>
  <div class="max-w-4xl mx-auto px-4 text-center">
    {%- if section.settings.eyebrow != blank -%}
      <span
        class="text-white/40 text-[10px] font-bold tracking-[0.5em] uppercase mb-6 block"
        aria-hidden="true"
      >
        {{ section.settings.eyebrow }}
      </span>
    {%- endif -%}

    <h2
      id="newsletter-heading-{{ section.id }}"
      class="text-4xl md:text-5xl italic mb-6"
    >
      {{ section.settings.heading }}
    </h2>

    {%- if section.settings.description != blank -%}
      <p
        id="newsletter-description-{{ section.id }}"
        class="text-white/60 mb-12 text-lg font-sans font-light"
      >
        {{ section.settings.description }}
      </p>
    {%- endif -%}

    <!-- Newsletter Form -->
    {%- form 'customer',
      id: 'newsletter-form-{{ section.id }}',
      class: 'flex flex-col sm:flex-row max-w-lg mx-auto gap-0 border border-white/20',
      aria-labelledby: 'newsletter-heading-{{ section.id }}'
    -%}
      <input type="hidden" name="contact[tags]" value="newsletter">

      <div class="relative flex-1">
        <label for="newsletter-email-{{ section.id }}" class="sr-only">
          {{ section.settings.email_label | default: 'Email address for newsletter subscription' }}
        </label>
        <input
          id="newsletter-email-{{ section.id }}"
          name="contact[email]"
          type="email"
          inputmode="email"
          autocomplete="email"
          placeholder="{{ section.settings.email_placeholder }}"
          class="
            w-full bg-transparent px-6 py-5 outline-none font-sans text-sm
            focus:bg-white/5 transition-colors
            focus:ring-2 focus:ring-white focus:ring-inset
            placeholder:text-white/30
          "
          required
          aria-required="true"
          aria-describedby="email-format-hint-{{ section.id }}"
        >
        <span id="email-format-hint-{{ section.id }}" class="sr-only">
          {{ section.settings.email_hint | default: 'Please enter a valid email address, like name@example.com' }}
        </span>
      </div>

      <button
        type="submit"
        class="
          px-10 py-5 font-bold tracking-[0.2em] uppercase text-xs
          hover:opacity-90 transition-colors
          focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2
          disabled:opacity-50 disabled:cursor-not-allowed
        "
        style="background-color: {{ section.settings.button_background }}; color: {{ section.settings.button_text_color }}; focus:ring-offset-color: {{ section.settings.background_color }};"
        aria-label="{{ section.settings.button_aria_label | default: 'Subscribe to newsletter' }}"
      >
        {{ section.settings.button_label }}
      </button>
    {%- endform -%}

    {%- if customer.has_account -%}
      {%- if form.posted_successfully? -%}
        <p
          class="mt-6 text-sm text-white/70 tracking-wide"
          role="status"
          aria-live="polite"
        >
          {{ section.settings.success_message }}
        </p>
      {%- endif -%}
    {%- endif -%}

    {%- if section.settings.privacy_note != blank -%}
      <p
        class="mt-8 text-[10px] text-white/30 tracking-widest uppercase"
        aria-label="{{ section.settings.privacy_aria_label | default: 'Privacy assurance' }}"
      >
        <span class="sr-only">Privacy notice: </span>
        {{ section.settings.privacy_note }}
      </p>
    {%- endif -%}

    <div
      id="newsletter-status-{{ section.id }}"
      class="sr-only"
      role="status"
      aria-live="polite"
      aria-atomic="true"
    ></div>
  </div>
</section>

{% schema %}
{
  "name": "Newsletter",
  "tag": "section",
  "class": "newsletter-section",
  "limit": 1,
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "eyebrow",
      "label": "Eyebrow text",
      "default": "The Vitrum Journal",
      "info": "Small decorative label above the heading. Leave blank to hide."
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Join Our Inner Circle"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Sign up to receive collection previews, artisan stories, and 10% off your first order."
    },
    {
      "type": "header",
      "content": "Form"
    },
    {
      "type": "text",
      "id": "email_placeholder",
      "label": "Email input placeholder",
      "default": "Enter your email address"
    },
    {
      "type": "text",
      "id": "email_label",
      "label": "Email input screen reader label",
      "default": "Email address for newsletter subscription",
      "info": "Accessible label for screen readers â€” not visible on screen."
    },
    {
      "type": "text",
      "id": "email_hint",
      "label": "Email format hint (screen reader)",
      "default": "Please enter a valid email address, like name@example.com",
      "info": "Screen reader hint describing the expected email format."
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button label",
      "default": "Subscribe"
    },
    {
      "type": "text",
      "id": "button_aria_label",
      "label": "Button aria-label",
      "default": "Subscribe to newsletter",
      "info": "Accessible label for the submit button."
    },
    {
      "type": "text",
      "id": "success_message",
      "label": "Success message",
      "default": "Thank you for subscribing! Check your inbox for a confirmation email."
    },
    {
      "type": "header",
      "content": "Footer note"
    },
    {
      "type": "text",
      "id": "privacy_note",
      "label": "Privacy note",
      "default": "No spam. Only beauty. Unsubscribe at any time.",
      "info": "Leave blank to hide."
    },
    {
      "type": "text",
      "id": "privacy_aria_label",
      "label": "Privacy note aria-label",
      "default": "Privacy assurance"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#1a1a1a"
    },
    {
      "type": "color",
      "id": "button_background",
      "label": "Button background color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text color",
      "default": "#18181b"
    }
  ],
  "presets": [
    {
      "name": "Newsletter",
      "category": "Email capture"
    }
  ]
}
{% endschema %}
