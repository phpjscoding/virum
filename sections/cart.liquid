{% comment %}
  This section is used in the cart template to render /cart page with an
  overview of the items in customer's cart.

  https://shopify.dev/docs/storefronts/themes/architecture/templates/cart
{% endcomment %}

<form action="{{ routes.cart_url }}" method="post">
  <table>
    {% for item in cart.items %}
      <tr>
        <td>
          {% render 'image', image: item.image, url: item.url %}
        </td>
        <td>
          <p>{{ item.product.title }}</p>
          {{ 'cart.remove' | t | link_to: item.url_to_remove }}
        </td>
        <td>
          <input type="text" name="updates[]" value="{{ item.quantity }}">
          <input type="submit" value="{{ 'cart.update' | t }}">
        </td>
      </tr>
    {% endfor %}
  </table>

  <input type="submit" name="checkout" value="{{ 'cart.checkout' | t }}">
</form>

<div class="max-w-7xl mx-auto px-4 md:px-8">
  <!-- Page Header -->
  <h1 class="text-6xl font-serif italic mb-16" id="cart-page-title">
    <h1>{{ 'cart.title' | t }}</h1>
  </h1>

  <!-- Cart Layout Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-12 gap-16">
    <!-- Cart Items Section -->
    <section class="lg:col-span-8 space-y-12" aria-labelledby="cart-page-title" role="region">
      {% if cart == empty %}
        cart is empty
        <a
          class="text-sm underline hover:no-underline focus:outline-none focus:ring-2 focus:ring-zinc-900 focus:ring-offset-2 rounded px-2 py-1"
          href="{{ routes.all_products_collection_url }}"
        >
          Go to collection
        </a>

      {% else %}
        <div class="sr-only" role="status" aria-live="polite" id="cart-status">
          {{ cart.item_count }} item in your cart
        </div>

        <!-- Cart Item -->
        {% form ,'cart',id:'cart' %}
          {% for item in cart.items %}
            <article class="flex gap-8 pb-12 border-b border-zinc-50" role="listitem">
              <!-- Product Image -->
              <div class="w-32 aspect-[3/4] bg-zinc-100 flex-shrink-0">
                <img
                  src="{{ item.image | image_url:width:180,loading:'lazy' }}"
                  alt="{{ item.product.title }}"
                  class="w-full h-full object-cover"
                  width="200"
                  height="300"
                >
              </div>

              <!-- Product Details -->
              <div class="flex-1 flex flex-col justify-between">
                <!-- Title and Remove Button Row -->
                <div class="flex justify-between items-start">
                  <h2 class="text-xl font-medium" id="product-title-p2">
                    {% if item.variant.title != 'Default Title' %}
                      {{ item.variant.title | escape }}

                    {% else %}
                      {{ item.product.title | escape }}
                    {% endif %}
                  </h2>
                  <a
                    href="{{ item.url_to_remove }}"
                    aria-label="Remove {{ item.title | escape }} cart"
                    class="p-1 hover:bg-zinc-100 focus:outline-none focus:ring-2 focus:ring-zinc-900 rounded transition-colors"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      aria-hidden="true"
                      class="lucide lucide-x w-5 h-5 text-zinc-300 hover:text-red-500 transition-colors"
                    >
                      <path d="M18 6 6 18"></path>
                      <path d="m6 6 12 12"></path>
                    </svg>
                  </a>
                </div>

                <!-- Quantity and Price Row -->
                <div class="flex items-end justify-between">
                  <!-- Quantity Controls -->
                  <div
                    class="flex border border-zinc-100"
                    role="group"
                    aria-labelledby="product-title-p2 quantity-label-p2"
                  >
                    <span id="quantity-label-p2" class="sr-only"
                      >Quantity for {{ item.product.title | escape }}, currently
                      {{ item | item_count_for_variant: item.variant.id }} items</span
                    >

                    <button
                      onclick="updateCartQuantity('p2', 'set-1', -1)"
                      aria-label="Decrease quantity from 2 to 1"
                      class="p-2 hover:bg-zinc-100 focus:outline-none focus:ring-2 focus:ring-zinc-900 transition-colors"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        aria-hidden="true"
                        class="lucide lucide-minus w-4 h-4"
                      >
                        <path d="M5 12h14"></path>
                      </svg>
                    </button>

                    <span
                      class="px-4 py-2 font-bold"
                      aria-current="quantity"
                      aria-label="Current quantity: {{ item | item_count_for_variant:item.variant.id }} items"
                    >
                      {{- item | item_count_for_variant: item.variant.id -}}
                    </span>
                    <input
                      type="number"
                      min="0"
                      inputmode="numeric"
                      value="{{ item.quantity }}"
                      name="updates[]"
                      id="quantity-{{ item.key  }}"
                      class="px-4 py-2 font-bold"
                      aria-current="quantity"
                      aria-label="Current quantity: {{ item.quantity }} items"
                    >

                    <button
                      aria-label="Increase quantity"
                      class="p-2 hover:bg-zinc-100 focus:outline-none focus:ring-2 focus:ring-zinc-900 transition-colors"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        aria-hidden="true"
                        class="lucide lucide-plus w-4 h-4"
                      >
                        <path d="M5 12h14"></path>
                        <path d="M12 5v14"></path>
                      </svg>
                    </button>
                  </div>

                  <!-- Price -->
                  <span class="text-lg font-medium" aria-label="Price: {{ item.final_line_price | money }}">
                    {{ item.final_line_price | money }}
                  </span>
                </div>

                <!-- Hidden Product Metadata for Screen Readers -->
                <div class="sr-only">
                  <p>Collection: {{ item.product.variant }}</p>
                  <p>In stock: {{ item.product.available }}</p>
                </div>
              </div>
            </article>
          {% endfor %}
        {% endform %}
      {% endif %}

      <!-- Additional cart items would go here with same structure -->

      <!-- Cart Actions (could be added if needed) -->
      <div class="flex justify-between items-center pt-4">
        <button
          onclick="continueShopping()"
          class="text-sm underline hover:no-underline focus:outline-none focus:ring-2 focus:ring-zinc-900 focus:ring-offset-2 rounded px-2 py-1"
          aria-label="Continue shopping"
        >
          ← Continue Shopping
        </button>

        <button
          onclick="updateCart()"
          class="text-sm border border-zinc-900 px-6 py-3 hover:bg-zinc-50 focus:outline-none focus:ring-2 focus:ring-zinc-900 focus:ring-offset-2 rounded transition-colors"
          aria-label="Update cart quantities"
        >
          Update Cart
        </button>
      </div>
    </section>

    <!-- Order Summary Sidebar -->
    <aside class="lg:col-span-4" aria-labelledby="order-summary-title">
      <div class="bg-zinc-50 p-8 sticky top-32 space-y-8">
        <h2 id="order-summary-title" class="text-xs font-bold uppercase tracking-widest">Order Summary</h2>

        <!-- Cost Breakdown -->
        <div class="space-y-4 text-sm text-zinc-500" role="region" aria-label="Cost breakdown">
          <div class="flex justify-between">
            <span id="subtotal-label">Subtotal</span>
            <span aria-labelledby="subtotal-label" aria-label="Subtotal: $178.00">$178.00</span>
          </div>

          <div class="flex justify-between">
            <span id="shipping-label">Shipping</span>
            <span aria-labelledby="shipping-label" aria-label="Shipping: Free">Free</span>
          </div>

          <div class="flex justify-between">
            <span id="tax-label">Estimated Tax</span>
            <span aria-labelledby="tax-label" aria-label="Estimated tax: $14.24">$14.24</span>
          </div>
        </div>

        <div class="h-px bg-zinc-200" role="separator" aria-orientation="horizontal"></div>

        <!-- Total -->
        <div class="flex justify-between text-2xl font-medium">
          <span id="total-label">Total</span>
          <span aria-labelledby="total-label" aria-label="Total amount: $192.24">$192.24</span>
        </div>

        <!-- Checkout Button -->
        <button
          class="w-full py-6 bg-zinc-900 text-white font-bold uppercase text-[10px] tracking-widest hover:bg-zinc-800 focus:outline-none focus:ring-2 focus:ring-zinc-900 focus:ring-offset-2 focus:ring-offset-zinc-50 transition-colors"
          aria-label="Proceed to checkout. Total: $192.24"
        >
          Checkout
        </button>

        <!-- Payment Methods (optional enhancement) -->
        <p class="text-[10px] text-zinc-400 text-center">
          <span class="sr-only">Accepted payment methods: </span>
          Visa • Mastercard • Amex • PayPal
        </p>
      </div>
    </aside>
  </div>

  <!-- Hidden Live Region for Cart Updates -->
  <div class="sr-only" role="status" aria-live="polite" aria-atomic="true" id="cart-update-announcer"></div>
</div>
<script>
  // Get current cart data
  fetch('/cart.js')
    .then((response) => response.json())
    .then((cart) => {
      // Option A: See the whole cart
      console.log('Full cart:', cart);
      console.log('All items:', cart.items);

      // Option B: Loop through each item and log useful values
      cart.items.forEach((item, index) => {
        console.log(`Item ${index + 1}:`);
        console.log('  Title:', item.title);
        console.log('  Variant ID:', item.variant_id);
        console.log('  Quantity:', item.quantity);
        console.log('  Price:', item.price / 100); // in dollars
        console.log('  Line price:', item.line_price / 100); // quantity × price
        console.log('  Properties:', item.properties); // custom line item props
        console.log('  Full item object:', item);
        console.log('---');
      });
    })
    .catch((error) => console.error('Cart fetch error:', error));
</script>
